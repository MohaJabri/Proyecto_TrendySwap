FROM python:3.10.2-slim-bullseye
ENV PYTHONUNBUFFERED 1

# Definici√≥n de argumentos
ARG SERVER_PORT 
ARG DJANGO_SECRET_KEY
ARG DB_ENGINE
ARG DB_NAME
ARG DB_USER
ARG DB_PASSWORD
ARG DB_HOST
ARG DB_PORT
ARG EMAIL_BACKEND
ARG EMAIL_HOST
ARG EMAIL_PORT
ARG EMAIL_HOST_USER
ARG EMAIL_HOST_PASSWORD
ARG EMAIL_USE_TLS

# Pasar los argumentos a variables de entorno
ENV SERVER_PORT=$SERVER_PORT 
ENV DJANGO_SECRET_KEY=$DJANGO_SECRET_KEY
ENV DB_ENGINE=$DB_ENGINE
ENV DB_NAME=$DB_NAME
ENV DB_USER=$DB_USER
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_HOST=$DB_HOST
ENV DB_PORT=$DB_PORT
ENV EMAIL_BACKEND=$EMAIL_BACKEND
ENV EMAIL_HOST=$EMAIL_HOST
ENV EMAIL_PORT=$EMAIL_PORT
ENV EMAIL_HOST_USER=$EMAIL_HOST_USER
ENV EMAIL_HOST_PASSWORD=$EMAIL_HOST_PASSWORD
ENV EMAIL_USE_TLS=$EMAIL_USE_TLS

EXPOSE 8000

WORKDIR /usr/src/app
COPY ./ /usr/src/app/

RUN pip install -r requirements.txt

CMD ["sh", "-c", "python manage.py makemigrations && python manage.py migrate && python manage.py loaddata categories && daphne -b 0.0.0.0 -p 8000 core.asgi:application"]
